<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
			"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.november.auth.mapper.UserMapper">
	<resultMap type="com.november.auth.domain.User" id="resultUser">
		<id property="id" column="id"/>
        <result property="loginName" column="loginName"/>
        <result property="name" column="name"/>
        <result property="password" column="password"/>
        <result property="gender" column="gender"/>
        <result property="birthday" column="birthday"/>
        <result property="province" column="province"/>
        <result property="city" column="city"/>
        <result property="area" column="area"/>
        <result property="address" column="address"/>
        <result property="mobile" column="mobile"/>
        <result property="tell" column="tell"/>
        <result property="safeQues" column="safeQues"/>
        <result property="safeAns" column="safeAns"/>
        <result property="qq" column="qq"/>
        <result property="email" column="email"/>
        <result property="level" column="level"/>
        <result property="balance" column="balance"/>
        <result property="consume" column="consume"/>
        <result property="integral" column="integral"/>
        <result property="loginNum" column="loginNum"/>
        <result property="registerDate" column="registerDate"/>
        <result property="firstLoginedTime" column="firstLoginedTime"/>
        <result property="lastLoginedTime" column="lastLoginedTime"/>
        <result property="pswChangeDate" column="pswChangeDate"/>
        <result property="locked" column="locked"/>
        <result property="status" column="status"/>
        <result property="createTime" column="createTime"/>
        <result property="updateTime" column="updateTime"/>
        <collection property="roles" ofType="com.november.auth.domain.Role">
            <id property="roleId" column="roleId"/>
            <result property="roleCode" column="roleCode"/>
            <result property="roleName" column="roleName"/>
            <collection property="resuorces" ofType="com.november.auth.domain.Resource">
                <id property="resId" column="resId"/>
                <result property="resType" column="resType"/>
                <result property="resString" column="resString"/>
                <result property="perString" column="perString"/>
            </collection>
        </collection>
	</resultMap>
	
	
	<select id="findUserByName" resultMap="resultUser" parameterType="string">
		SELECT
			us.id,
			us.loginName,
			us.name,
			us.password,
			us.gender,
			us.birthday,
			us.province,
			us.city,
			us.area,
			us.address,
			us.mobile,
			us.tell,
			us.safeQues,
			us.safeAns,
			us.qq,
			us.email,
			us.level,
			us.consume,
			us.integral,
			us.loginNum,
			us.registerDate,
			us.firstLoginedTime,
			us.lastLoginedTime,
			us.pswChangeDate,
			us.locked,
			us.status,
			us.createTime,
			us.updateTime,
			ro.role_id AS roleId,
			ro.role_name AS roleName,
			ro.role_code AS roleCode,
			res.res_id AS resId,
			res.res_type AS resType,
			res.res_string AS resString,
			res.per_string AS perString
		FROM
			nov_user us
		JOIN nov_user_role ur ON us.id = ur.user_id
		JOIN nov_role ro ON ur.role_id = ro.role_id
		JOIN nov_role_resource rr ON rr.role_id = ro.role_id
		JOIN nov_resource res ON rr.resource_id = resource_id and res.enabled='0'
		<where>
			<if test="username != null and username != ''">
				us.loginName=#{username}
			</if>
		</where>
	</select>
	
	
	<update id="updateUser" parameterType="com.november.auth.domain.User">
		update nov_user
		<set>
			<if test="updateTime != null and updateTime != ''">
				updateTime = #{updateTime},
			</if>
			<if test="name != null and name != ''">
				name = #{name},
			</if>
			<if test="password != null and password != ''">
				password = #{password},
			</if>
			<if test="gender != null and gender != ''">
				gender = #{gender},
			</if>
			<if test="birthday != null and birthday != ''">
				birthday = #{birthday},
			</if>
			<if test="province != null and province != ''">
				province = #{province},
			</if>
			<if test="city != null and city != ''">
				city = #{city},
			</if>
			<if test="area != null and area != ''">
				area = #{area},
			</if>
			<if test="address != null and address != ''">
				address = #{address},
			</if>
			<if test="mobile != null and mobile != ''">
				mobile = #{mobile},
			</if>
			<if test="tell != null and tell != ''">
				tell = #{tell},
			</if>
			<if test="safeQues != null and safeQues != ''">
				safeQues = #{safeQues},
			</if>
			<if test="safeAns != null and safeAns != ''">
				safeAns = #{safeAns},
			</if>
			<if test="qq != null and qq != ''">
				qq = #{qq},
			</if>
			<if test="email != null and email != ''">
				email = #{email},
			</if>
			<if test="level != null and level != ''">
				level = #{level},
			</if>
			<if test="consume != null and consume != ''">
				consume = #{consume},
			</if>
			<if test="integral != null and integral != ''">
				integral = #{integral},
			</if>
			<if test="loginNum != null and loginNum != ''">
				loginNum = #{loginNum},
			</if>
			<if test="lastLoginedTime != null and lastLoginedTime != ''">
				lastLoginedTime = #{lastLoginedTime},
			</if>
			<if test="pswChangeDate != null and pswChangeDate != ''">
				pswChangeDate = #{pswChangeDate},
			</if>
			<if test="locked != null and locked != ''">
				locked = #{locked},
			</if>
		</set>
		<where>
			id = #{id}
		</where>
	</update>
	
</mapper>































